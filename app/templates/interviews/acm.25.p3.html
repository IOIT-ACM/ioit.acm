<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>ACM Recruitment Phase 3 Interview Queue - Live Updates</title>
    <meta
      name="description"
      content="Stay updated with the ACM Recruitment Phase 3 interview queue. View the live interview status, see who's currently on call, and check the complete order of upcoming candidates."
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/lucide@latest"></script>

    <meta property="og:type" content="website" />
    <meta property="og:title" content="ACM Recruitment Phase 3 Interviews" />
    <meta
      property="og:description"
      content="Live status for the ACM Student Chapter Phase 3 recruitment interviews."
    />
    <meta property="og:url" content="https://ioit.acm.org/" />
    <meta
      property="og:image"
      content="{{ url_for('static', filename='og-image.png') }}"
    />
    <meta property="og:site_name" content="AISSMS IOIT ACM" />
    <meta property="og:locale" content="en_US" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="ACM Recruitment Phase 3 Interviews" />
    <meta
      name="twitter:description"
      content="Live status for the ACM Student Chapter Phase 3 recruitment interviews."
    />
    <meta
      name="twitter:image"
      content="{{ url_for('static', filename='og-image.png') }}"
    />
    <meta name="twitter:site" content="@IOITACM" />
    <meta name="twitter:creator" content="@IOITACM" />

    <link
      rel="icon"
      type="image/svg+xml"
      href="{{ url_for('static', filename='favicon.svg') }}"
    />

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-Y6Z6G51Z27"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "G-Y6Z6G51Z27");
    </script>

    <style>
      body {
        font-family: "Inter", sans-serif;
        background-color: #0a0a0a;
        background-image: linear-gradient(
            135deg,
            rgba(34, 197, 94, 0.2) 0%,
            rgba(59, 130, 246, 0.15) 50%,
            rgba(249, 115, 22, 0.2) 100%
          ),
          url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.02'%3E%3Cpath d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        background-attachment: fixed;
      }
      .card {
        background: rgba(40, 40, 52, 0.4);
        backdrop-filter: blur(24px);
        -webkit-backdrop-filter: blur(24px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        border-radius: 24px;
        box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.4);
      }
      *::-webkit-scrollbar {
        display: none;
      }
      * {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .collapsible-content {
        transition: all 0.3s ease-in-out;
        overflow: hidden;
      }
    </style>
  </head>
  <body class="text-white/90 antialiased">
    <header
      class="sticky top-0 z-30 border-b border-white/10 bg-black/50 backdrop-blur-lg"
    >
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between md:h-24 h-20"
      >
        <a href="/" class="flex items-center">
          <img
            src="https://ioit.acm.org/static/img/assets/acm.png"
            alt="ACM Logo"
            class="h-12 w-auto mr-4"
          />
          <div class="hidden md:block">
            <h1 class="md:text-3xl text-xl font-bold">
              ACM Recruitment Phase 3 Interviews
            </h1>
            <p id="headerCounts" class="text-sm text-white/60 font-medium mt-1">
              Loading…
            </p>
          </div>
        </a>
      </div>
    </header>

    <main class="max-w-7xl mx-auto p-3 sm:p-6 lg:p-8">
      <div id="currentContainer" class="mb-8"></div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="lg:col-span-2 gap-2" id="daysContainer">
          <!-- Day sections will be dynamically inserted here -->
        </div>

        <aside class="card p-6 gap-2 h-fit">
          <div>
            <div
              class="flex items-center justify-between mb-4 pb-3 border-b border-white/10"
            >
              <h3 class="text-xl font-medium">Interviews</h3>
            </div>
            <p>
              Absent candidates please contact a group admin for your interview
              status.
            </p>
          </div>

          <div>
            <div
              class="flex items-center justify-between mb-4 pb-3 border-b border-white/10 mt-10"
            >
              <h3 class="text-xl font-medium">Absent</h3>
              <span
                id="absentCount"
                class="text-sm font-medium text-white/60"
              ></span>
            </div>
            <div id="absentList" class="space-y-3 pr-1"></div>
          </div>

          <div>
            <div
              class="flex items-center justify-between mb-4 pb-3 border-b border-white/10 mt-5"
            >
              <h3 class="text-xl font-medium">Completed</h3>
              <span
                id="completedCount"
                class="text-sm font-medium text-white/60"
              ></span>
            </div>
            <div id="completedList" class="space-y-3 pr-1"></div>
          </div>
        </aside>
      </div>
    </main>

    <div
      class="fixed bottom-6 right-6 lg:bottom-8 lg:right-8 z-40 flex flex-col gap-3"
    >
      <button
        id="openSearchBtn"
        class="bg-blue-600 hover:bg-blue-700 text-white rounded-full p-3 shadow-lg transition-transform"
      >
        <i data-lucide="search" class="w-5 h-5"></i>
      </button>
    </div>

    <div
      id="searchModal"
      class="fixed inset-0 bg-black/60 backdrop-blur-sm flex justify-center p-4 z-50 hidden pt-10"
    >
      <div id="searchModalOverlay" class="absolute inset-0"></div>
      <div
        class="card w-full max-w-2xl max-h-[80vh] flex flex-col relative z-10 h-fit"
      >
        <div class="p-4 border-b border-white/10 flex items-center gap-4">
          <i data-lucide="search" class="w-5 h-5 text-white/50"></i>
          <input
            type="text"
            id="searchInput"
            placeholder="Search your name..."
            class="w-full bg-transparent focus:outline-none text-lg"
          />
          <button id="closeSearchBtn" class="text-white/50 hover:text-white">
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>
        <div id="searchResults" class="p-4 space-y-3 overflow-y-auto"></div>
      </div>
    </div>

    <script>
      let allCandidates = [];

      function initials(name) {
        return (name || "")
          .split(" ")
          .map((s) => s[0])
          .slice(0, 2)
          .join("")
          .toUpperCase();
      }

      function createLargeCard(c) {
        const wrap = document.createElement("div");
        let baseClasses =
          "flex items-center gap-4 p-4 border rounded-2xl transition-all duration-300";

        if (c.completed) {
          wrap.className = `${baseClasses} bg-green-500/10 border-green-500/20`;
        } else if (c.absent) {
          wrap.className = `${baseClasses} bg-red-500/10 border-red-500/20`;
        } else {
          wrap.className = `${baseClasses} bg-black/20 border-white/10 hover:bg-black/30 hover:border-white/20`;
        }

        const avatar = document.createElement("div");
        avatar.className =
          "w-12 h-12 rounded-lg bg-white/10 flex-shrink-0 flex items-center justify-center font-bold text-base text-white/90";
        avatar.textContent = initials(c.name);

        const info = document.createElement("div");
        info.className = "flex-1 min-w-0";
        const name = document.createElement("div");
        name.className = "font-semibold text-white truncate";
        name.textContent = c.name;
        const domain = document.createElement("div");
        domain.className = "text-sm text-white/60 truncate mt-1";
        domain.textContent = c.domain || "";
        info.appendChild(name);
        info.appendChild(domain);

        const status = document.createElement("div");
        status.className =
          "text-xs font-medium px-3 py-1 rounded-full whitespace-nowrap flex items-center gap-1.5";

        if (c.inCall) {
          status.className += " bg-green-500/10 text-green-400";
          status.innerHTML = `<div class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div> In call`;
        } else if (c.completed) {
          status.className += " bg-green-500/10 text-green-400";
          status.textContent = "Completed";
        } else if (c.absent) {
          status.className += " bg-red-500/10 text-red-400";
          status.textContent = "Absent";
        } else {
          status.className += " bg-blue-500/10 text-blue-400";
          status.textContent = "Waiting";
        }

        wrap.appendChild(avatar);
        wrap.appendChild(info);
        wrap.appendChild(status);
        return wrap;
      }

      function createSmallCard(c) {
        const wrap = document.createElement("div");
        wrap.className =
          "flex items-center gap-3 p-2.5 bg-black/20 border border-white/10 rounded-xl";
        const avatar = document.createElement("div");
        avatar.className =
          "w-10 h-10 rounded-md bg-white/10 flex-shrink-0 flex items-center justify-center font-bold text-sm text-white/90";
        avatar.textContent = initials(c.name);
        const info = document.createElement("div");
        info.className = "flex-1 min-w-0";
        const name = document.createElement("div");
        name.className = "font-medium text-sm text-white truncate";
        name.textContent = c.name;
        const domain = document.createElement("div");
        domain.className = "text-xs text-white/60 truncate";
        domain.textContent = c.domain || "";
        info.appendChild(name);
        info.appendChild(domain);
        wrap.appendChild(avatar);
        wrap.appendChild(info);
        return wrap;
      }

      function createSearchCard(c) {
        const wrap = document.createElement("div");
        let baseClasses = "flex items-center gap-3 p-2.5 border rounded-xl";

        if (c.completed) {
          wrap.className = `${baseClasses} bg-green-500/10 border-green-500/20`;
        } else if (c.absent) {
          wrap.className = `${baseClasses} bg-red-500/10 border-red-500/20`;
        } else {
          wrap.className = `${baseClasses} bg-black/20 border-white/10`;
        }

        const avatar = document.createElement("div");
        avatar.className =
          "w-10 h-10 rounded-md bg-white/10 flex-shrink-0 flex items-center justify-center font-bold text-sm text-white/90";
        avatar.textContent = initials(c.name);

        const info = document.createElement("div");
        info.className = "flex-1 min-w-0";
        const name = document.createElement("div");
        name.className = "font-medium text-sm text-white truncate";
        name.textContent = c.name;

        const details = document.createElement("div");
        details.className =
          "text-xs text-white/60 truncate flex items-center gap-2 mt-1";

        const domain = document.createElement("span");
        domain.textContent = c.domain || "";

        const separator = document.createElement("span");
        separator.textContent = "•";

        const date = document.createElement("span");
        date.textContent = `Day ${c.day}`;

        details.appendChild(domain);
        details.appendChild(separator);
        details.appendChild(date);

        info.appendChild(name);
        info.appendChild(details);
        wrap.appendChild(avatar);
        wrap.appendChild(info);
        return wrap;
      }

      function createMessageScreen(iconName, title, message) {
        const screen = document.createElement("div");
        screen.className = "text-center p-8 text-white/50";
        screen.innerHTML = `<i data-lucide="${iconName}" class="w-12 h-12 mx-auto mb-4 opacity-40"></i><h3 class="text-lg font-semibold text-white/80">${title}</h3><p class="mt-1 text-sm">${message}</p>`;
        return screen;
      }

      function createLargeSkeleton() {
        const skeleton = document.createElement("div");
        skeleton.className =
          "flex items-center gap-4 p-4 bg-black/20 border border-white/10 rounded-2xl animate-pulse";
        skeleton.innerHTML = `<div class="w-12 h-12 rounded-lg bg-white/10 flex-shrink-0"></div><div class="flex-1 min-w-0 space-y-2"><div class="h-4 bg-white/10 rounded w-3/4"></div><div class="h-3 bg-white/10 rounded w-1/2"></div></div><div class="h-6 bg-white/10 rounded-full w-20"></div>`;
        return skeleton;
      }

      function createSmallSkeleton() {
        const skeleton = document.createElement("div");
        skeleton.className =
          "flex items-center gap-3 p-2.5 bg-black/20 border border-white/10 rounded-xl animate-pulse";
        skeleton.innerHTML = `<div class="w-10 h-10 rounded-md bg-white/10 flex-shrink-0"></div><div class="flex-1 min-w-0 space-y-2"><div class="h-3 bg-white/10 rounded w-5/6"></div><div class="h-3 bg-white/10 rounded w-2/3"></div></div>`;
        return skeleton;
      }

      function renderLoading() {
        const daysContainer = document.getElementById("daysContainer");
        daysContainer.innerHTML = "";
        for (let i = 0; i < 2; i++) {
          const skeletonCard = document.createElement("div");
          skeletonCard.className = "card md:p-6 p-3 h-fit mb-4 animate-pulse";
          skeletonCard.innerHTML = `
                <div class="h-8 bg-white/10 rounded w-1/3 mb-6"></div>
                <div class="space-y-4">
                    ${createLargeSkeleton().outerHTML}
                    ${createLargeSkeleton().outerHTML}
                </div>
            `;
          daysContainer.appendChild(skeletonCard);
        }

        absentList.innerHTML = "";
        completedList.innerHTML = "";
        for (let i = 0; i < 3; i++) {
          absentList.appendChild(createSmallSkeleton());
          completedList.appendChild(createSmallSkeleton());
        }
      }

      function renderError(error) {
        const main = document.querySelector("main");
        headerCounts.textContent = "Error loading data";
        main.innerHTML = "";
        const errorCard = document.createElement("div");
        errorCard.className = "card p-6";
        errorCard.appendChild(
          createMessageScreen(
            "wifi-off",
            "Failed to Load Data",
            `Could not retrieve the interview queue. Please check your connection and try again.<br><br><code class="text-xs bg-black/20 p-2 rounded-md border border-white/10">${error.message}</code>`,
          ),
        );
        main.appendChild(errorCard);
        lucide.createIcons();
      }

      function getStatusPriority(c) {
        if (c.inCall) return 0;
        if (!c.completed && !c.absent) return 1;
        if (c.completed) return 2;
        if (c.absent) return 3;
        return 4;
      }

      function render(candidates) {
        const current = candidates.find((c) => c.inCall === true);
        const absent = candidates.filter((c) => c.absent === true);
        const completed = candidates.filter((c) => c.completed === true);
        const waiting = candidates.filter(
          (c) => !c.completed && !c.absent && !c.inCall,
        );

        headerCounts.textContent = `Total: ${candidates.length} | Waiting: ${waiting.length} | Completed: ${completed.length} | Absent: ${absent.length}`;
        absentCount.textContent = `${absent.length} Candidates`;
        completedCount.textContent = `${completed.length} Candidates`;

        currentContainer.innerHTML = "";
        const currentWrapper = document.createElement("div");
        currentWrapper.className = "card p-6";
        const currentHeading = document.createElement("h2");
        currentHeading.className =
          "text-2xl font-medium mb-6 pb-4 border-b border-white/10";
        currentHeading.textContent = "Currently Interviewing";
        currentWrapper.appendChild(currentHeading);
        if (current) {
          currentWrapper.appendChild(createLargeCard(current));
        } else {
          currentWrapper.appendChild(
            createMessageScreen(
              "user-check",
              "No one in the call right now",
              "Next candidate be ready.",
            ),
          );
        }
        currentContainer.appendChild(currentWrapper);

        const candidatesByDay = candidates.reduce((acc, candidate) => {
          const day = candidate.day || "Unknown";
          if (!acc[day]) {
            acc[day] = [];
          }
          acc[day].push(candidate);
          return acc;
        }, {});

        const sortedDays = Object.keys(candidatesByDay).sort((a, b) => a - b);
        const daysContainer = document.getElementById("daysContainer");
        daysContainer.innerHTML = "";

        sortedDays.forEach((day) => {
          const dayCandidates = candidatesByDay[day].sort(
            (a, b) => getStatusPriority(a) - getStatusPriority(b),
          );
          const waitingCount = dayCandidates.filter(
            (c) => !c.completed && !c.absent && !c.inCall,
          ).length;

          const section = document.createElement("section");
          section.id = `day${day}Card`;
          section.className = "card md:p-6 p-3 h-fit mb-4";
          section.innerHTML = `
                <div class="collapsible-header flex items-center justify-between mb-6 pb-4 border-b border-white/10 p-2 cursor-pointer md:flex-row flex-col">
                    <h2 class="text-2xl font-medium">Day ${day}</h2>
                    <div class="flex items-center gap-4">
                        <span class="text-sm font-medium text-white/60">${waitingCount} Waiting</span>
                        <i data-lucide="chevron-down" class="w-5 h-5 transition-transform"></i>
                    </div>
                </div>
                <div class="collapsible-content space-y-4"></div>
            `;
          daysContainer.appendChild(section);

          const listEl = section.querySelector(".collapsible-content");
          if (dayCandidates.length === 0) {
            listEl.appendChild(
              createMessageScreen(
                "calendar-check",
                `Queue Clear`,
                `No candidates scheduled for this day.`,
              ),
            );
          } else {
            dayCandidates.forEach((c) =>
              listEl.appendChild(createLargeCard(c)),
            );
          }

          section
            .querySelector(".collapsible-header")
            .addEventListener("click", () => {
              const content = section.querySelector(".collapsible-content");
              const icon = section.querySelector(
                'i[data-lucide="chevron-down"]',
              );
              content.classList.toggle("hidden");
              icon.classList.toggle("rotate-180");
            });
        });

        absentList.innerHTML = "";
        if (absent.length === 0) {
          absentList.appendChild(
            createMessageScreen("user-x", "No Absences", ""),
          );
        } else {
          absent.forEach((c) => absentList.appendChild(createSmallCard(c)));
        }

        completedList.innerHTML = "";
        if (completed.length === 0) {
          completedList.appendChild(
            createMessageScreen("list-checks", "No Completions", ""),
          );
        } else {
          completed.forEach((c) =>
            completedList.appendChild(createSmallCard(c)),
          );
        }
        lucide.createIcons();
      }

      async function fetchAndRender() {
        try {
          const response = await fetch("https://api.ioit.acm.org/acmp3");
          if (!response.ok) {
            throw new Error(
              `API request failed: ${response.status} ${response.statusText}`,
            );
          }
          const apiData = await response.json();
          allCandidates = apiData.map((item, index) => ({
            id: `c${index + 1}`,
            name: item.Name || "N/A",
            domain: item.domain || "N/A",
            inCall: String(item.inCall).toUpperCase() === "TRUE",
            completed: String(item.completed).toUpperCase() === "TRUE",
            absent: String(item.absent).toUpperCase() === "TRUE",
            day: parseInt(item.day) || 1,
          }));
          render(allCandidates);
        } catch (error) {
          console.error("Failed to fetch or render candidates:", error);
          renderError(error);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        renderLoading();
        fetchAndRender();

        const openSearchBtn = document.getElementById("openSearchBtn");
        const closeSearchBtn = document.getElementById("closeSearchBtn");
        const searchModal = document.getElementById("searchModal");
        const searchModalOverlay =
          document.getElementById("searchModalOverlay");
        const searchInput = document.getElementById("searchInput");
        const searchResultsContainer = document.getElementById("searchResults");

        const openSearchModal = () => {
          searchModal.classList.remove("hidden");
          searchInput.focus();
          searchResultsContainer.innerHTML = "";
          searchResultsContainer.appendChild(
            createMessageScreen(
              "search",
              "Search Your Name",
              "Start typing a name to see results.",
            ),
          );
          lucide.createIcons();
        };

        const closeSearchModal = () => {
          searchModal.classList.add("hidden");
          searchInput.value = "";
          searchResultsContainer.innerHTML = "";
        };

        openSearchBtn.addEventListener("click", openSearchModal);
        closeSearchBtn.addEventListener("click", closeSearchModal);
        searchModalOverlay.addEventListener("click", closeSearchModal);

        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && !searchModal.classList.contains("hidden")) {
            closeSearchModal();
          }
        });

        searchInput.addEventListener("input", () => {
          const query = searchInput.value.toLowerCase().trim();
          searchResultsContainer.innerHTML = "";

          if (!query) {
            searchResultsContainer.appendChild(
              createMessageScreen(
                "search",
                "Search Candidates",
                "Start typing a name to see results.",
              ),
            );
            lucide.createIcons();
            return;
          }

          const results = allCandidates.filter((c) =>
            c.name.toLowerCase().includes(query),
          );

          if (results.length > 0) {
            results.forEach((c) => {
              searchResultsContainer.appendChild(createSearchCard(c));
            });
          } else {
            searchResultsContainer.appendChild(
              createMessageScreen(
                "user-x",
                "No Results Found",
                `No candidates match the name "${searchInput.value}".`,
              ),
            );
          }
          lucide.createIcons();
        });
      });
    </script>
  </body>
</html>
