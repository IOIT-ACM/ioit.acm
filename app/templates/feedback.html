{% extends "competitions/base.html" %} {% block title %}Feedback Form - IOIT
ACM{% endblock %} {% block og_title %}Give Your Feedback{% endblock %} {% block
og_description %} Help us improve by sharing your valuable feedback. We’d love
to hear your suggestions, event ideas, and overall experience with the AISSMS IOIT ACM
Student Chapter. {% endblock %} {% block og_image %}{{ url_for('static',
filename='img/assets/feedback.jpeg') }}{% endblock %} {% block twitter_image
%}{{ url_for('static', filename='img/assets/feedback.jpeg') }}{% endblock %} {%
block twitter_title %}Feedback - AISSMS IOIT ACM{% endblock %} {% block
twitter_description %} Your feedback matters to us! Share your thoughts and
ideas to help us create a better and more inclusive AISSMS IOIT ACM community. {%
endblock %} {% block content %}

<div class="max-w-6xl mx-auto p-6">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div class="w-full flex justify-center mt-10 md:mt-0">
      <div class="w-1/2 md:mt-20 h-fit sticky top-32">
        <div
          class="aspect-square bg-blue-500 w-1/2 h-auto transform absolute border border-white rounded-xl animate-rotate"
        ></div>
        <div
          class="aspect-square overflow-hidden bg-white w-full h-auto transform rotate-45 rounded-3xl border-4 border-white shadow-lg shadow-blue-400"
        >
          <img
            class="-rotate-45 z-50"
            src="{{ url_for('static', filename='og-image.png') }}"
            alt="about-image"
          />
        </div>
      </div>
    </div>

    <div>
      <form id="feedbackForm" class="grid gap-4 mt-5 md:mt-0">
        <div class="mb-3 text-center grid gap-4">
          <label for="feedbackType" class="font-medium text-gray-700"
            >Select Feedback Type:</label
          >
          <div class="flex flex-col md:flex-row justify-center gap-1 md:gap-4">
            <div class="flex items-center">
              <input
                type="radio"
                id="generalFeedback"
                name="feedbackType"
                value="general"
                checked
                onclick="toggleFeedbackFields()"
                class="mr-2"
              />
              <label for="generalFeedback" class="text-gray-700"
                >General Feedback</label
              >
            </div>

            <div class="flex items-center">
              <input
                type="radio"
                id="eventFeedback"
                name="feedbackType"
                value="event"
                onclick="toggleFeedbackFields()"
                class="mr-2"
              />
              <label for="eventFeedback" class="text-gray-700"
                >Event Feedback</label
              >
            </div>

            <div class="flex items-center">
              <input
                type="radio"
                id="suggestions"
                name="feedbackType"
                value="suggestions"
                onclick="toggleFeedbackFields()"
                class="mr-2"
              />
              <label for="suggestions" class="text-gray-700">Suggestions</label>
            </div>
          </div>
        </div>

        <div>
          <label for="name" class="block text-sm font-medium text-gray-700 mt-3"
            >Name</label
          >
          <input
            type="text"
            id="name"
            name="name"
            required
            value="{{ current_user.name }}"
            placeholder="Enter your name"
            class="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none"
          />
        </div>
        <div>
          <label
            for="branch"
            class="block text-sm font-medium text-gray-700 mt-3"
            >Branch</label
          >
          <select
            id="branch"
            name="branch"
            required
            class="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none"
          >
            <option value="">Select your branch</option>
            <option value="AI&DS">
              Artificial Intelligence & Data Science
            </option>
            <option value="CS">Computer Science</option>
            <option value="IT">Information Technology</option>
            <option value="INSTRU">Instrumentation</option>
            <option value="ELECTRICAL">Electrical</option>
            <option value="EnTC">Electronics and Telecommunication</option>
          </select>
        </div>

        <div>
          <label for="year" class="block text-sm font-medium text-gray-700 mt-3"
            >Year</label
          >
          <select
            id="year"
            name="year"
            required
            class="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none"
          >
            <option value="">Select your year</option>
            <option value="FY">First Year</option>
            <option value="SY">Second Year</option>
            <option value="TY">Third Year</option>
            <option value="BE">Fourth Year</option>
          </select>
        </div>

        <div class="flex items-center gap-3">
          <div class="flex items-center space-x-2 mt-1">
            <input
              type="checkbox"
              id="is_acm_member"
              name="is_acm_member"
              class="w-5 h-5 rounded-full"
            />
            <label
              for="is_acm_member"
              class="block text-sm font-medium text-gray-700"
            >
              Are you an ACM member?
            </label>
          </div>
        </div>

        <div class="flex items-center gap-3">
          <div class="flex items-center space-x-2 mt-1">
            <input
              type="checkbox"
              id="is_ioit"
              name="is_ioit"
              class="w-5 h-5 rounded-full"
            />
            <label
              for="is_ioit"
              class="block text-sm font-medium text-gray-700"
            >
              Are you from AISSMS IOIT Pune?
            </label>
          </div>
        </div>

        <div id="eventFeedbackSection" class="hidden space-y-4 grid gap-4">
          <div class="flex flex-col">
            <label for="event" class="text-sm font-medium text-gray-700 mt-3">
              Which event did you attend or hear about?
            </label>
            <select
              id="event"
              name="event"
              class="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none"
            >
              <option value="">Select an event</option>
              {% for event in event_names %}
              <option value="{{ event }}">{{ event }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="flex flex-col">
            <label
              for="eventRating"
              class="text-sm font-medium text-gray-700 mt-3 z-40"
            >
              Rate the event
            </label>
            <input
              type="range"
              id="eventRating"
              name="eventRating"
              min="0"
              max="100"
              value="80"
              class="w-full mt-1 z-40"
            />
            <div
              id="emojiOverlay"
              class="hidden fixed inset-0 bg-white bg-opacity-50 flex items-center justify-center z-40"
            >
              <div class="text-center">
                <p id="emojiDisplay" class="text-6xl z-50"></p>
                <p
                  id="sliderValueDisplay"
                  class="text-xl mt-5 text-gray-700"
                ></p>
              </div>
            </div>
          </div>

          <div class="flex flex-col">
            <label
              for="eventFeedback"
              class="text-sm font-medium text-gray-700 mt-3"
            >
              Event Feedback
            </label>
            <textarea
              id="eventFeedback"
              name="eventFeedback"
              rows="4"
              placeholder="Share your experience of the event and suggest what can we do better to give an ideal experience"
              maxlength="500"
              class="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none"
              oninput="updateCharacterCount('eventFeedback', 'eventFeedback-counter')"
            ></textarea>
            <div class="text-right text-sm text-gray-500">
              <span id="eventFeedback-counter">0</span>/500
            </div>
          </div>
        </div>

        <div id="suggestionsSection" class="hidden grid gap-4">
          <div class="flex flex-col">
            <label
              for="events"
              class="block text-sm font-medium text-gray-700 mt-3"
            >
              Suggestions
            </label>
            <textarea
              id="events"
              name="events"
              rows="4"
              maxlength="500"
              placeholder="What events would you like to see conducted by ACM?"
              class="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none"
              oninput="updateCharacterCount('events', 'events-counter')"
            ></textarea>
            <div class="text-right text-sm text-gray-500">
              <span id="events-counter">0</span>/500
            </div>
          </div>
        </div>

        <div id="generalFeedbackSection" class="grid gap-4">
          <div class="flex flex-col">
            <label
              for="feedback"
              class="block text-sm font-medium text-gray-700 mt-3"
            >
              We appreciate your feedback. Please tell us what you think.
            </label>
            <textarea
              id="feedback"
              name="feedback"
              rows="4"
              maxlength="500"
              class="w-full mt-1 p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:outline-none"
              oninput="updateCharacterCount('feedback', 'feedback-counter')"
            ></textarea>
            <div class="text-right text-sm text-gray-500">
              <span id="feedback-counter">0</span>/500
            </div>
          </div>
        </div>

        <button
          id="submitButton"
          type="submit"
          class="w-full py-3 bg-blue-500 text-white font-semibold rounded-md shadow-md hover:bg-blue-600 focus:ring-2 focus:ring-blue-400 focus:ring-offset-2 focus:outline-none"
        >
          Submit Feedback
        </button>
      </form>
    </div>
  </div>
</div>

<!-- Popup Modal -->

<div
  id="thankYouModal"
  class="fixed inset-0 flex justify-center items-center bg-black bg-opacity-50 px-8 hidden"
>
  <div class="bg-white p-4 rounded-lg text-center max-w-md w-full relative z-[9999999999999999999]">
    <h2 class="py-2 text-lg font-semibold">Thank you for your feedback!</h2>
    <hr class="border-t border-gray-300 my-4" />
    <p class="mb-3 text-sm text-gray-600">
      We appreciate the time you've taken to share your thoughts. Your input
      helps us improve and create a better experience for everyone.
    </p>
    <div class="flex justify-center gap-3 mb-3">
      <a href="/" class="text-blue-500 text-sm hover:underline">Home</a>
      <a href="/events" class="text-blue-500 text-sm hover:underline">Events</a>
      <a href="/gallery" class="text-blue-500 text-sm hover:underline"
        >Gallery</a
      >
      <a href="/membership" class="text-blue-500 text-sm hover:underline"
        >Membership</a
      >
    </div>
    <p class="text-sm text-gray-600">
      We look forward to seeing you at our future events.
    </p>
  </div>
</div>

<script>
    function toggleFeedbackFields() {
      const generalSection = document.getElementById("generalFeedbackSection");
      const eventSection = document.getElementById("eventFeedbackSection");
      const suggestionsSection = document.getElementById("suggestionsSection");

      // Hide all sections initially
      generalSection.style.display = "none";
      eventSection.style.display = "none";
      suggestionsSection.style.display = "none";

      // Show the appropriate section based on the selected type
      const selectedType = document.querySelector(
        'input[name="feedbackType"]:checked'
      ).value;

      if (selectedType === "general") {
        generalSection.style.display = "block";
      } else if (selectedType === "event") {
        eventSection.style.display = "block";
      } else if (selectedType === "suggestions") {
        suggestionsSection.style.display = "block";
      }
    }

    function updateCharacterCount(textareaId, counterId) {
      const textarea = document.getElementById(textareaId);
      const counter = document.getElementById(counterId);
      counter.textContent = textarea.value.length;
    }

    document.addEventListener("DOMContentLoaded", () => {
      const urlParams = new URLSearchParams(window.location.search);
      const type = urlParams.get("type");
      const eventParam = urlParams.get("event");

      // Set the correct feedback type based on URL parameters
      if (type === "eventfeedback") {
        document.getElementById("eventFeedback").checked = true;
      } else if (type === "general") {
        document.getElementById("generalFeedback").checked = true;
      } else if (type === "suggestions") {
        document.getElementById("suggestions").checked = true;
      }

      // Preselect the event if it exists in the URL and matches available options
      if (eventParam && {{ event_names | tojson }}.includes(eventParam)) {
        document.getElementById("event").value = eventParam;
      }

      // Adjust the visible fields based on the initial feedback type
      toggleFeedbackFields();
    });

    async function handleSubmit(event) {
    event.preventDefault();

    const selectedType = document.querySelector(
      'input[name="feedbackType"]:checked'
    ).value;
    const eventField = document.getElementById("event");

    // Validate event selection if the feedback type is 'event'
    if (selectedType === "event" && !eventField.value) {
      alert("Please select an event before submitting event feedback.");
      return;
    }

    // Collect form data
    const form = document.getElementById("feedbackForm");
    const formData = new FormData(form);
    const formObject = Object.fromEntries(formData.entries());

    const submitButton = document.getElementById("submitButton");
    submitButton.textContent = "Submitting data...";
  submitButton.disabled = true;

    try {
      const response = await fetch("/feedback", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(formObject),
      });

      if (response.ok) {
        submitButton.textContent = "Form submitted";
        // Show success modal or redirect
        document.getElementById("thankYouModal").classList.remove("hidden");
      } else {
        submitButton.textContent = "Submit Feedback";
        alert("Failed to submit feedback. Please try again.");
      }
    } catch (error) {
      console.error("Error submitting feedback:", error);
      submitButton.textContent = "Submit Feedback";
      alert("An error occurred. Please try again.");
    }
  }

  document.getElementById("feedbackForm").addEventListener("submit", handleSubmit);
</script>

<script>
  const emojiRanges = [
    { range: [90, 100], emoji: "🤩" }, // Super excited
    { range: [80, 89], emoji: "😁" }, // Very happy
    { range: [70, 79], emoji: "😊" }, // Happy
    { range: [60, 69], emoji: "🙂" }, // Content
    { range: [50, 59], emoji: "😐" }, // Neutral
    { range: [40, 49], emoji: "😕" }, // Slightly disappointed
    { range: [30, 39], emoji: "☹️" }, // Disappointed
    { range: [20, 29], emoji: "😟" }, // Worried
    { range: [10, 19], emoji: "😢" }, // Sad
    { range: [0, 9], emoji: "😡" }, // Angry
  ];

  const slider = document.getElementById("eventRating");
  const overlay = document.getElementById("emojiOverlay");
  const emojiDisplay = document.getElementById("emojiDisplay");
  const sliderValueDisplay = document.getElementById("sliderValueDisplay");

  slider.addEventListener("input", () => {
    const value = parseInt(slider.value, 10);

    const matchedEmoji = emojiRanges.find(
      (item) => value >= item.range[0] && value <= item.range[1],
    )?.emoji;

    if (matchedEmoji) {
      emojiDisplay.textContent = matchedEmoji;

      const scaledFontSize = 50 + (value / 100) * 70;
      emojiDisplay.style.fontSize = `${scaledFontSize}px`;
      sliderValueDisplay.textContent = `${value}/100`;
      overlay.classList.remove("hidden");
    }
  });

  slider.addEventListener("change", () => {
    overlay.classList.add("hidden");
  });
</script>

{% endblock %}
