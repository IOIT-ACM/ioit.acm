{% extends "forms/base.html" %} {% block title %}ACM Committee Recruitment
Form{% endblock %} {% block content %}
<div class="max-w-6xl mx-auto md:p-6">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    <div class="w-full flex justify-center mt-10 md:mt-0">
      <div class="w-1/2 md:mt-20 h-fit sticky top-32">
        <div
          class="aspect-square bg-blue-500 w-1/2 h-auto transform absolute border border-white rounded-xl animate-rotate"
        ></div>
        <div
          class="aspect-square overflow-hidden bg-white w-full h-auto transform rotate-45 rounded-3xl border-4 border-white shadow-lg shadow-blue-400"
        >
          <img
            class="-rotate-45 z-50"
            src="{{ url_for('static', filename='og-image.png') }}"
            alt="about-image"
          />
        </div>
      </div>
    </div>

    <form id="acmForm" class="p-5 md:p-0 space-y-6">
      <div id="step-0" class="form-step p-4 md:p-6">
        <div class="text-gray-700">
          <h1
            class="text-2xl md:text-3xl font-bold text-blue-600 mb-4 text-center"
          >
            Hey!
          </h1>
          <p class="text-lg mb-4">
            Thank you for taking interest in applying for the IOIT ACM Student
            Chapter Committee! We are delighted to see your enthusiasm.
          </p>
          <p class="text-lg mb-4">
            Joining our committee is a fantastic opportunity to contribute,
            lead, and shape the activities of the ACM Student Chapter. We value
            dedication, teamwork, and a passion for technology and community
            building.
          </p>
          <p class="text-lg mb-6">
            We're excited to learn more about you through this application.
            Please proceed by clicking the button below.
          </p>
          <div class="flex justify-center">
            <button
              type="button"
              onclick="nextStep()"
              class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition"
            >
              Begin Application
            </button>
          </div>
        </div>
      </div>

      <div id="step-1" class="form-step hidden">
        <p class="text-lg font-semibold text-gray-700 mb-6">
          Step 1: General Information
        </p>
        <hr class="border-t-2 border-gray-500 my-6" />
        <div class="mb-4">
          <label class="block text-gray-700 font-semibold mb-2 mt-10"
            >Full Name</label
          >
          <input
            type="text"
            name="fullName"
            placeholder="Enter full name"
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        <div class="mb-4">
          <label class="block text-gray-700 font-semibold mb-2 mt-10"
            >Branch</label
          >
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {% for b in ['CS','IT','AI&DS','ENTC','ELEC','INSTRU'] %}
            <label
              class="radio-option w-full flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer transition focus-within:ring-0"
            >
              <input
                type="radio"
                name="branch"
                value="{{ b }}"
                class="accent-blue-500 focus:outline-none mr-3"
              />
              <span class="text-gray-800 font-medium">{{ b }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        <div class="mb-6">
          <label class="block text-gray-700 font-semibold mb-2 mt-10"
            >Year</label
          >
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            {% for y in ['FY','SY','TY','BE'] %}
            <label
              class="radio-option w-full flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer transition focus-within:ring-0"
            >
              <input
                type="radio"
                name="year"
                value="{{ y }}"
                class="accent-blue-500 focus:outline-none mr-3"
              />
              <span class="text-gray-800 font-medium">{{ y }}</span>
            </label>
            {% endfor %}
          </div>
        </div>
        <div class="mb-6">
          <label class="block text-gray-700 font-semibold mb-2 mt-10"
            >Mobile Number</label
          >
          <input
            type="tel"
            name="mobile"
            placeholder="Enter mobile number"
            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          />
        </div>
        <button
          type="button"
          onclick="nextStep()"
          class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition"
        >
          Next
        </button>
      </div>

      <div id="step-2" class="form-step hidden">
        <p class="text-lg font-semibold text-gray-700 mb-6">
          Step 2: Choose Your Desired Position
        </p>
        <hr class="border-t-2 border-gray-500 my-6" />
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
          {% set committee_roles = [ {'value': 'technical_secretary', 'text':
          'Technical Secretary'}, {'value': 'media_head', 'text': 'Media Head'},
          {'value': 'web_team', 'text': 'Web Team'}, {'value': 'doc_team',
          'text': 'Doc Team'}, {'value': 'tech_team', 'text': 'Tech Team'},
          {'value': 'event_management_team', 'text': 'Event Management Team'} ]
          %} {% for role in committee_roles %}
          <label
            class="radio-option w-full flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer transition focus-within:ring-0"
          >
            <input
              type="radio"
              name="roleType"
              value="{{ role.value }}"
              onchange="renderRoleSpecificFields()"
              class="accent-blue-500 focus:outline-none mr-3"
            />
            <span class="text-gray-800 font-medium">{{ role.text }}</span>
          </label>
          {% endfor %}
        </div>
        <div class="flex justify-between">
          <button
            type="button"
            onclick="prevStep()"
            class="bg-gray-300 hover:bg-gray-400 text-black font-bold py-2 px-4 rounded-lg transition"
          >
            Back
          </button>
          <button
            type="button"
            onclick="nextStep()"
            class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition"
          >
            Next
          </button>
        </div>
      </div>

      <div id="step-3" class="form-step hidden space-y-6">
        <p class="text-lg font-semibold text-gray-700 mb-2">
          Step 3: Experience
        </p>
        <hr class="border-t-2 border-gray-500 my-4" />

        <div
          id="technical_secretary-fields"
          class="role-section hidden space-y-4"
        >
          <p class="text-md font-semibold text-gray-600 mb-2">
            For Technical Secretary:
          </p>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >Describe your organizational skills and experience with
              documentation.</label
            >
            <textarea
              name="ts_q1"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >How would you ensure effective communication within the
              committee?</label
            >
            <textarea
              name="ts_q2"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >What tools or methods would you use for managing meeting minutes
              and records?</label
            >
            <textarea
              name="ts_q3"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
        </div>

        <div id="media_head-fields" class="role-section hidden space-y-4">
          <p class="text-md font-semibold text-gray-600 mb-2">
            For Media Head:
          </p>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >What's your experience with social media management and content
              creation?</label
            >
            <textarea
              name="mh_q1"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >How would you strategize to increase ACM's online presence and
              engagement?</label
            >
            <textarea
              name="mh_q2"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >Can you share a link to a portfolio or examples of your media
              work (if any)?</label
            >
            <input
              type="text"
              name="mh_q3"
              placeholder="https://example.com/portfolio"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            />
          </div>
        </div>

        <div id="web_team-fields" class="role-section hidden space-y-4">
          <p class="text-md font-semibold text-gray-600 mb-2">For Web Team:</p>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >Describe your experience with web development technologies (HTML,
              CSS, JS, frameworks).</label
            >
            <textarea
              name="wt_q1"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >Have you worked with version control systems like Git? Briefly
              explain.</label
            >
            <textarea
              name="wt_q2"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >Provide a link to your GitHub profile or a web project you've
              worked on (if any).</label
            >
            <input
              type="text"
              name="wt_q3"
              placeholder="https://github.com/yourusername"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            />
          </div>
        </div>

        <div id="doc_team-fields" class="role-section hidden space-y-4">
          <p class="text-md font-semibold text-gray-600 mb-2">For Doc Team:</p>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >What is your experience with technical writing or creating
              documentation?</label
            >
            <textarea
              name="dt_q1"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >How do you ensure clarity and accuracy in documentation?</label
            >
            <textarea
              name="dt_q2"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >Are you familiar with any documentation tools or platforms (e.g.,
              Markdown, Confluence, ReadtheDocs)?</label
            >
            <textarea
              name="dt_q3"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
        </div>

        <div id="tech_team-fields" class="role-section hidden space-y-4">
          <p class="text-md font-semibold text-gray-600 mb-2">For Tech Team:</p>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >What are your primary technical skills or areas of interest
              (e.g., programming languages, AI/ML, cybersecurity)?</label
            >
            <textarea
              name="tt_q1"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >Describe a technical project you've worked on or a problem you've
              solved.</label
            >
            <textarea
              name="tt_q2"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >How do you stay updated with the latest technological
              advancements?</label
            >
            <textarea
              name="tt_q3"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
        </div>

        <div
          id="event_management_team-fields"
          class="role-section hidden space-y-4"
        >
          <p class="text-md font-semibold text-gray-600 mb-2">
            For Event Management Team:
          </p>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >Describe any experience you have in planning or organizing events
              (academic or non-academic).</label
            >
            <textarea
              name="em_q1"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >How would you handle unexpected challenges or logistical issues
              during an event?</label
            >
            <textarea
              name="em_q2"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2"
              >What qualities do you believe are essential for successful event
              management and teamwork?</label
            >
            <textarea
              name="em_q3"
              rows="3"
              class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
            ></textarea>
          </div>
        </div>

        <div class="space-y-4 mt-6 pt-4 border-t border-gray-300">
          <label class="block text-gray-700 font-semibold mb-2 mt-6"
            >Previous Experience (in any relevant field, if any)</label
          >
          <textarea
            name="experience"
            rows="3"
            placeholder="Briefly describe any previous roles, projects, or activities."
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
          ></textarea>
          <label class="block text-gray-700 font-semibold mb-2 mt-6"
            >Why are you interested in joining the ACM Committee and this
            specific position?</label
          >
          <textarea
            name="whyApply"
            rows="3"
            placeholder="Explain your motivation and what you hope to contribute."
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500"
          ></textarea>
        </div>
        <div class="flex justify-between pt-4">
          <button
            type="button"
            onclick="prevStep()"
            class="bg-gray-300 hover:bg-gray-400 text-black font-bold py-2 px-4 rounded-lg transition"
          >
            Back
          </button>
          <div class="relative">
            <button
              type="submit"
              id="submitBtn"
              class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg transition"
            >
              Submit Application
            </button>
            <div
              id="spinner"
              class="hidden absolute inset-0 flex items-center justify-center bg-white bg-opacity-75 rounded-lg"
            >
              <svg
                class="animate-spin h-6 w-6 text-blue-500"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
              >
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                />
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8v8z"
                />
              </svg>
            </div>
          </div>
        </div>
        <p id="formMsg" class="text-center text-lg font-semibold mt-4"></p>
      </div>
    </form>
  </div>
</div>

<!-- JS -->
<script>
  let currentStep = 0,
    formMemory = {};

  const roleSpecificQuestionKeys = {
    technical_secretary: ['ts_q1', 'ts_q2', 'ts_q3'],
    media_head: ['mh_q1', 'mh_q2', 'mh_q3'],
    web_team: ['wt_q1', 'wt_q2', 'wt_q3'],
    doc_team: ['dt_q1', 'dt_q2', 'dt_q3'],
    tech_team: ['tt_q1', 'tt_q2', 'tt_q3'],
    event_management_team: ['em_q1', 'em_q2', 'em_q3'],
  };

  function saveFormData() {
    const f = document.getElementById('acmForm'),
      fd = new FormData(f);
    formMemory = {};
    f.querySelectorAll(
      'input[type="text"],input[type="tel"],textarea,select'
    ).forEach((e) => {
      if (!e.disabled && e.value.trim()) {
        formMemory[e.name] = e.value;
      }
    });
    f.querySelectorAll('input[type="radio"]:checked').forEach(
      (e) => (formMemory[e.name] = e.value)
    );
    formMemory.currentStep = currentStep;
  }

  function loadFormData() {
    if (!Object.keys(formMemory).length) return;
    const f = document.getElementById('acmForm');
    Object.keys(formMemory).forEach((n) => {
      if (n === 'currentStep') return;
      const e = f.querySelector(`[name="${n}"]`);
      if (e) {
        if (e.type === 'radio') {
          const r = f.querySelector(`[name="${n}"][value="${formMemory[n]}"]`);
          if (r) {
            r.checked = true;
            updateRadioStyling(r);
          }
        } else {
          e.value = formMemory[n];
        }
      }
    });
    if (formMemory.roleType) {
      renderRoleSpecificFields();
    }
  }

  function updateRadioStyling(r) {
    document.querySelectorAll(`input[name="${r.name}"]`).forEach((e) => {
      const l = e.closest('.radio-option');
      if (l) {
        l.classList.remove('bg-blue-100', 'border-blue-500');
        l.classList.add('border-gray-300');
      }
    });
    const s = r.closest('.radio-option');
    if (s) {
      s.classList.remove('border-gray-300');
      s.classList.add('bg-blue-100', 'border-blue-500');
    }
  }

  function goToStep(s, isLoading = false) {
    document
      .querySelectorAll('.form-step')
      .forEach((d) => d.classList.add('hidden'));
    const targetStepElement = document.getElementById(`step-${s}`);
    if (targetStepElement) {
      targetStepElement.classList.remove('hidden');
    }
    currentStep = s;
    if (!isLoading) {
      saveFormData();
    }
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  function nextStep() {
    if (currentStep === 0) {
      goToStep(1);
    } else if (currentStep < 3) {
      if (validateStep(currentStep)) {
        goToStep(currentStep + 1);
        if (currentStep === 2) {
          renderRoleSpecificFields();
        }
      }
    }
  }

  function prevStep() {
    if (currentStep > 0) {
      goToStep(currentStep - 1);
      if (currentStep === 2) {
        renderRoleSpecificFields();
      }
    }
  }

  function renderRoleSpecificFields() {
    const selectedRoleRadio = document.querySelector(
      'input[name="roleType"]:checked'
    );
    document.querySelectorAll('.role-section').forEach((section) => {
      section.classList.add('hidden');
      section
        .querySelectorAll('textarea, input, select')
        .forEach((el) => (el.disabled = true));
    });

    if (selectedRoleRadio) {
      const roleValue = selectedRoleRadio.value;
      const fieldsContainerId = `${roleValue}-fields`;
      const fieldsContainer = document.getElementById(fieldsContainerId);
      if (fieldsContainer) {
        fieldsContainer.classList.remove('hidden');
        fieldsContainer
          .querySelectorAll('textarea, input, select')
          .forEach((el) => (el.disabled = false));
      }
    }
  }

  function validateStep(n) {
    const stepElement = document.getElementById(`step-${n}`);
    const formElement = document.getElementById('acmForm');
    const formData = new FormData(formElement);

    let fieldsToValidate = [];
    if (n === 1) {
      fieldsToValidate = ['fullName', 'branch', 'year', 'mobile'];
    } else if (n === 2) {
      fieldsToValidate = ['roleType'];
    } else if (n === 3) {
      fieldsToValidate = ['experience', 'whyApply'];
      const selectedRoleType = formData.get('roleType');
      if (selectedRoleType && roleSpecificQuestionKeys[selectedRoleType]) {
        fieldsToValidate = fieldsToValidate.concat(
          roleSpecificQuestionKeys[selectedRoleType]
        );
      }
    }

    let isValid = true;
    let firstInvalidField = null;

    stepElement
      .querySelectorAll('.border-red-500')
      .forEach((el) => el.classList.remove('border-red-500'));
    stepElement.querySelectorAll('.error-msg').forEach((el) => el.remove());

    for (const fieldName of fieldsToValidate) {
      const fieldElements = stepElement.querySelectorAll(
        `[name="${fieldName}"]:not([disabled])`
      );
      if (!fieldElements.length) continue;

      let fieldHasValue = false;
      if (fieldElements[0].type === 'radio') {
        fieldHasValue = [...fieldElements].some((radio) => radio.checked);
      } else {
        fieldHasValue = fieldElements[0].value.trim() !== '';
      }

      if (!fieldHasValue) {
        isValid = false;
        fieldElements.forEach((el) => {
          const parentDiv = el.closest('.radio-option') || el.closest('div');
          el.classList.add('border-red-500');
          if (parentDiv && !parentDiv.querySelector('.error-msg')) {
            const errorMsgElement = document.createElement('p');
            errorMsgElement.className = 'text-sm text-red-500 mt-1 error-msg';
            errorMsgElement.innerText = 'This field is required.';
            if (el.type === 'radio') {
              const radioGroupContainer =
                el.closest('div.gap-4') || el.closest('div.mb-6');
              if (
                radioGroupContainer &&
                !radioGroupContainer.querySelector('.error-msg')
              ) {
                radioGroupContainer.appendChild(errorMsgElement);
              }
            } else {
              parentDiv.appendChild(errorMsgElement);
            }
          }
        });
        if (!firstInvalidField) firstInvalidField = fieldElements[0];
      }
    }

    if (!isValid && firstInvalidField) {
      firstInvalidField.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
    return isValid;
  }

  function handleRadioSelection() {
    document.querySelectorAll('input[type="radio"]').forEach((r) =>
      r.addEventListener('change', function () {
        updateRadioStyling(this);
        if (this.name === 'roleType') {
          renderRoleSpecificFields();
        }
        saveFormData();
      })
    );
  }

  function clearFormMemory() {
    formMemory = {};
    localStorage.removeItem('acmCommitteeFormData');
  }

  function setupAutoSave() {
    const storedFormData = localStorage.getItem('acmCommitteeFormData');
    if (storedFormData) {
      formMemory = JSON.parse(storedFormData);
    }

    setInterval(() => {
      saveFormData();
      localStorage.setItem('acmCommitteeFormData', JSON.stringify(formMemory));
    }, 5000);

    document.querySelectorAll('input,select,textarea').forEach((e) => {
      e.addEventListener('input', () => {
        saveFormData();
        localStorage.setItem(
          'acmCommitteeFormData',
          JSON.stringify(formMemory)
        );
      });
      e.addEventListener('change', () => {
        saveFormData();
        localStorage.setItem(
          'acmCommitteeFormData',
          JSON.stringify(formMemory)
        );
      });
    });
  }

  document.addEventListener('DOMContentLoaded', () => {
    setupAutoSave();
    loadFormData();

    if (!formMemory.currentStep && formMemory.currentStep !== 0) {
      goToStep(0, true);
    }

    renderRoleSpecificFields();
    handleRadioSelection();

    document.querySelectorAll('input,select,textarea').forEach((e) =>
      e.addEventListener('input', () => {
        e.classList.remove('border-red-500');
        const parentDiv = e.closest('.radio-option') || e.closest('div');
        const errorMsg = parentDiv
          ? parentDiv.querySelector('.error-msg')
          : null;
        if (errorMsg) errorMsg.remove();

        if (e.type === 'radio') {
          const radioGroupContainer =
            e.closest('div.gap-4') || e.closest('div.mb-6');
          const groupErrorMsg = radioGroupContainer
            ? radioGroupContainer.querySelector('.error-msg')
            : null;
          if (groupErrorMsg) groupErrorMsg.remove();
        }
      })
    );

    document.getElementById('acmForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!validateStep(3)) return;

      saveFormData();
      const dataToSubmit = { ...formMemory };
      delete dataToSubmit.currentStep;

      const submitButton = document.getElementById('submitBtn');
      const spinnerElement = document.getElementById('spinner');
      const formMessageElement = document.getElementById('formMsg');

      submitButton.disabled = true;
      spinnerElement.classList.remove('hidden');
      formMessageElement.innerText = '';

      try {
        const response = await fetch(
          "{{ url_for('recruitment.acm_recruitment_form') }}",
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(dataToSubmit),
          }
        );
        const result = await response.json();
        formMessageElement.className =
          'text-center text-lg font-semibold mt-4 ' +
          (response.ok ? 'text-green-600' : 'text-red-600');
        formMessageElement.innerText = response.ok
          ? result.message
          : result.error || 'An unknown error occurred.';
        if (response.ok) {
          clearFormMemory();
          document.getElementById('acmForm').reset();
          goToStep(0);
        }
      } catch (error) {
        formMessageElement.className =
          'text-center text-lg font-semibold mt-4 text-red-600';
        formMessageElement.innerText =
          'Submission failed due to a network or server error.';
      } finally {
        submitButton.disabled = false;
        spinnerElement.classList.add('hidden');
      }
    });

    window.addEventListener('beforeunload', () => {
      saveFormData();
      localStorage.setItem('acmCommitteeFormData', JSON.stringify(formMemory));
    });
  });
</script>
{% endblock %}
